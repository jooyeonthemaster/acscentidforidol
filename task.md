# 향수 추천 시스템 개선 태스크
API의 이미지 분석 및 향수 추천 프로세스
1. 이미지 분석 프로세스
사용자가 아이돌 이미지와 정보를 제출하면 app/api/analyze/route.ts에서 처리합니다.
이미지는 Base64로 변환된 후 app/utils/gemini.ts의 analyzeIdolImage 함수로 전달됩니다.
Gemini API(gemini-2.0-flash 모델)가 상세한 프롬프트를 통해 이미지를 분석하고 다음 정보를 JSON으로 반환합니다:
traits: 10가지 특성 점수 (섹시함, 귀여움, 카리스마, 다크함, 청량함, 우아함, 자유로움, 럭셔리함, 순수함, 독특함)
dominantColors: 이미지의 주요 색상(HEX)
personalColor: 퍼스널 컬러 분석 결과
analysis: 이미지의 분위기, 스타일, 아우라, 톤앤매너 등
matchingKeywords: 이미지와 어울리는 키워드
2. 향수 매칭 프로세스
이미지 분석 결과를 바탕으로 app/utils/perfumeUtils.ts의 findMatchingPerfumes 함수가 호출됩니다.
핵심은 코사인 유사도 알고리즘을 사용하여 특성 점수를 비교하는 것입니다:
이미지 분석에서 얻은 10가지 특성(traits) 점수와
perfumePersonas.ts에 정의된 30개 향수의 특성 점수를 비교
중요: 향 카테고리(citrus, floral 등)는 매칭에 사용되지 않고, 오직 특성(traits) 점수만 매칭에 사용됩니다
유사도가 높은 순으로 향수가 정렬되어 반환됩니다.
3. 참고 데이터
모든 향수 데이터는 app/data/perfumePersonas.ts에 미리 정의되어 있습니다.
각 향수는 ID, 이름, 설명, 10가지 특성 점수, 6가지 향 카테고리 점수 등을 포함합니다.
특성 점수는 매칭에 사용되고, 향 카테고리 점수는 결과 표시에만 사용됩니다.
4. 최종 분석 결과
최종 분석 보고서에는 다음 값들이 포함됩니다:
traits: AI가 이미지에서 분석한 10가지 특성 점수 (3-10 사이)
scentCategories: 매칭된 향수의 6가지 향 카테고리 점수 (매칭에 사용되지는 않음)
dominantColors: 이미지의 주요 색상 코드
personalColor: 퍼스널 컬러 분석 (계절감, 톤, 색상 팔레트)
analysis: 이미지 분위기, 스타일, 표현, 콘셉트, 아우라, 톤앤매너 분석
matchingKeywords: 이미지와 어울리는 키워드
matchingPerfumes: 매칭된 향수 정보 (ID, 점수, 매칭 이유, 향수 데이터)
5. 데이터 흐름
사용자가 IdolInfoForm에서 아이돌 정보와 이미지를 제출
/api/analyze로 API 요청 전송
Gemini API로 이미지 분석 및 특성 점수 생성
코사인 유사도 계산으로 향수 매칭
분석 결과를 클라이언트에 반환하여 로컬 스토리지에 저장
app/result/page.tsx에서 결과 표시 (이미지 분석 탭과 향수 추천 탭)
이 시스템은 이미지의 시각적 특성을 10가지 특성 점수로 변환하고, 이를 기존 향수 데이터베이스와 비교하여 가장 유사한 향수를 찾아주는 방식으로 작동합니다. 향 카테고리는 매칭에 사용되지 않고 결과 시각화에만 활용됩니다.
## 핵심 개념 정의

### 향 카테고리(categories)
- 향수 데이터에 이미 정의된 6가지 카테고리에 대한 점수 (1-10)
  - citrus: 시트러스 계열 (레몬, 라임, 베르가못 등)
  - floral: 플로럴 계열 (장미, 자스민, 라일락 등)
  - woody: 우디 계열 (샌달우드, 시더우드, 베티버 등)
  - musky: 머스크 계열 (앰버, 머스크 등)
  - fruity: 프루티 계열 (복숭아, 베리류, 사과 등)
  - spicy: 스파이시 계열 (후추, 계피, 넛메그 등)
- **중요**: 이 카테고리 점수는 AI가 이미지를 분석해서 새로 생성하는 것이 아님
- 이미 perfumePersonas.ts 파일에 각 향수마다 정의된 카테고리 점수를 그대로 사용
- 주 용도: 향수가 어떤 계열인지 시각화하여 보여주는 용도
- 예: BK-2201281은 fruity 점수가 7점으로 가장 높으니 fruity 계열 향수로 표현

### 특성 점수(traits)
- 10가지 특성에 대한 점수 (3-10)
  - sexy: 섹시함
  - cute: 귀여움
  - charisma: 카리스마
  - darkness: 다크함
  - freshness: 청량함
  - elegance: 우아함
  - freedom: 자유로움
  - luxury: 럭셔리함
  - purity: 순수함
  - uniqueness: 독특함
- **중요**: AI가 이미지를 분석하여 이 특성 점수를 생성
- 생성된 특성 점수와 perfumePersonas.ts 파일의 향수별 traits 점수를 비교하여 유사도 계산
- 주 용도: 향수 매칭의 핵심 기준 (코사인 유사도 기반)

## 작업 방식 명확화

### 이미지 분석 및 향수 매칭 프로세스
1. 사용자 이미지 분석
   - AI(Gemini)가 이미지를 분석하여 10가지 특성(traits) 점수 생성
   - 이미지의 스타일, 분위기, 아우라, 톤앤매너 등을 상세히 분석
   - 사용자가 입력한 질문 폼에 맞춰 분석 내용 맞춤화

2. 향수 매칭
   - 이미지 분석 결과의 traits와 perfumePersonas.ts 파일의 30개 향수 traits 간 코사인 유사도 계산
   - 유사도가 가장 높은 향수를 추천
   - **중요**: 향 카테고리(categories)는 매칭에 사용하지 않음

3. 분석 보고서 생성
   - 매칭된 향수의 특징과 이미지 분석을 연결하여 상세한 매칭 이유 설명
   - 이미지 분석 내용을 바탕으로 향수 description을 맞춤화하여 설명
   - 매칭된 향수의 카테고리 정보를 시각화하여 어떤 계열의 향수인지 표현
   - 전문적이고 재미있는 형태의 분석 보고서 제공


## 파일 구조 정리 (2024-07-05)

### 중복 파일 문제
- [ ] 중복 파일 확인 및 정리
  - [ ] `/utils/gemini.ts`와 `/app/utils/gemini.ts` 중복 확인 - `/app/utils/gemini.ts`가 최신 버전
  - [ ] `/utils/perfume.ts`와 `/app/utils/perfumeUtils.ts` 중복 확인 - `/app/utils/perfumeUtils.ts`가 최신 버전
  - [ ] 루트의 `/utils` 폴더 내 파일들을 `/app/utils`로 통합
  - [ ] 더 이상 사용하지 않는 파일 제거

### 임포트 문제
- [x] `/app/utils/gemini.ts`에서 `perfumePersonas` 임포트 방식 수정 (named import → default import)
  - [x] 수정 전: `import { perfumePersonas } from '../data/perfumePersonas';`
  - [x] 수정 후: `import perfumePersonas from '../data/perfumePersonas';`

### API 디렉토리 구조 정리
- [ ] `/app/api` 폴더 내 엔드포인트 확인 및 정리
  - [ ] `/app/api/analyze` - 이미지 분석 API
  - [ ] `/app/api/recommend` - 향수 추천 API
  - [ ] `/app/api/perfume`, `/app/api/perfumes` - 향수 정보 관련 API
  - [ ] 기타 API 엔드포인트 확인 및 문서화
- [ ] API 엔드포인트 문서화 

## 문제 해결 체크리스트 (2023-11-08)

- [x] API 응답 구조 불일치 문제 수정
  - [x] app/api/analyze/route.ts 파일에서 API 응답 구조를 단순화하여 중첩 객체를 없애고 직접 분석 결과만 반환하도록 변경
  - [x] components/info/IdolInfoForm.tsx 파일에서 API 응답 처리 로직 개선 (data.result || data 방식으로 이전 버전과 호환성 유지)
  - [x] 필수 필드(traits, scentCategories, matchingPerfumes) 검증 로직 추가

- [x] 오류 처리 개선
  - [x] 필수 필드가 누락된 경우 의미 있는 오류 메시지 표시
  - [x] 로깅 구조 개선하여 디버깅 용이성 향상

- [ ] 향후 개선 사항
  - [ ] 모든 API 엔드포인트의 응답 형식 일관성 확보
  - [ ] 엄격한 타입 체크와 검증 로직 강화
  - [ ] 사용자 피드백 메시지 개선
  - [ ] 로깅 시스템 표준화 

## UI/UX 개선 체크리스트 (2023-11-09)

- [x] 결과 페이지 개선 
  - [x] API 응답 구조 수정으로 결과 페이지가 정상적으로 표시됨 (traits 필드 누락 오류 해결)
  - [x] 결과 페이지 상단에 사용자가 업로드한 분석 이미지 첨부
  - [x] 이미지 아래에 분석 결과를 바탕으로 상징적인 "트윗형" 이름 표시
  - [x] 이미지 분위기 설명을 perfumePersonas.ts의 description 스타일을 참고하여 더 자극적이고 유쾌하게 개선
  - [x] 스타일 분석과 아우라 & 톤앤매너 섹션의 디자인 개선 및 내용 강화
  - [x] 전체적인 레이아웃 고도화 및 시각적 매력 향상

- [x] 분석 결과 표현 개선
  - [x] 분석 결과의 문구를 더 자극적이고 유쾌하게 수정 (gemini.ts 프롬프트 변경)
  - [x] 향수와 이미지 매칭 이유 설명 강화
  - [x] 사용자 이미지에 맞는 더 개성 있는 "페르소나" 생성

## UI/UX 개선 상세 내용 (2023-11-09)

- 결과 페이지 상단에 사용자 이미지 표시
  - 로컬 스토리지에 저장된 'idolImagePreview' 이미지를 결과 페이지 상단에 표시
  - 이미지에 그림자 효과와 테두리를 적용하여 시각적 매력 향상

- 트위터스타일 닉네임 생성
  - 분석 결과의 특성과 키워드를 기반으로 유니크한 트위터 스타일 이름 생성
  - 랜덤한 패턴 중 하나를 선택하여 이미지마다 다른 독특한 이름 생성
  - 트위터 UI 스타일로 표시하여 실제 SNS 프로필처럼 보이게 구현

- 이미지 분석 결과 개선
  - gemini.ts 프롬프트 수정으로 mood, style, aura, toneAndManner 설명이 더 자극적이고 유쾌하게 변경
  - perfumePersonas.ts의 description 스타일을 참고한 과장된 표현과 따옴표를 활용한 말투 인용 추가
  - "눈 마주치는 순간 영혼까지 사로잡는 카리스마 폭격기" 같은 과감한 묘사로 사용자 경험 향상

- 시각적 디자인 개선
  - 레이더 차트를 추가하여 특성 점수를 직관적으로 표시
  - 점수에 따라 동적으로 색상이 변경되는 인터페이스
  - 아이콘과 그라데이션 배경을 활용한 세련된 UI
  - 카드 디자인에 호버 효과 추가로 상호작용성 향상
  - KeywordCloud 컴포넌트를 사용하여 매칭 키워드 시각화 개선

- 데이터 조직 및 레이아웃 개선
  - 각 섹션에 부제목 추가로 정보 명확성 강화
  - 계층적 구조로 정보를 재배치하여 가독성 개선
  - 타이포그래피 스타일 개선으로 중요 정보 강조
  - 공간 활용 최적화 및 일관된 디자인 언어 적용 