# ğŸ”¥ Firebase Realtime Database â†’ Firestore ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [ë§ˆì´ê·¸ë ˆì´ì…˜ ê°œìš”](#ë§ˆì´ê·¸ë ˆì´ì…˜-ê°œìš”)
2. [ì„±ëŠ¥ ê°œì„  íš¨ê³¼](#ì„±ëŠ¥-ê°œì„ -íš¨ê³¼)
3. [ìƒˆë¡œìš´ êµ¬ì¡°](#ìƒˆë¡œìš´-êµ¬ì¡°)
4. [ì„¤ì¹˜ ë° ì„¤ì •](#ì„¤ì¹˜-ë°-ì„¤ì •)
5. [ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰](#ë§ˆì´ê·¸ë ˆì´ì…˜-ì‹¤í–‰)
6. [API ë³€ê²½ì‚¬í•­](#api-ë³€ê²½ì‚¬í•­)
7. [ì„±ëŠ¥ ë¹„êµ](#ì„±ëŠ¥-ë¹„êµ)
8. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)

## ğŸš€ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°œìš”

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ìœ 
- **ë¹„ìš© ì ˆì•½**: 934MB/ì¼ ë‹¤ìš´ë¡œë“œ â†’ ê±°ì˜ 0ì›
- **ì„±ëŠ¥ í–¥ìƒ**: 90% ë¹ ë¥¸ ì‘ë‹µ ì‹œê°„
- **í™•ì¥ì„±**: ì§„ì§œ í˜ì´ì§€ë„¤ì´ì…˜ ì§€ì›
- **ê´€ë¦¬ í¸ì˜ì„±**: ì •ê·œí™”ëœ ë°ì´í„° êµ¬ì¡°

### ì£¼ìš” ë³€ê²½ì‚¬í•­
- Realtime Database JSON êµ¬ì¡° â†’ Firestore ì»¬ë ‰ì…˜/ë¬¸ì„œ êµ¬ì¡°
- í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í˜ì´ì§€ë„¤ì´ì…˜ â†’ ì„œë²„ ì‚¬ì´ë“œ í˜ì´ì§€ë„¤ì´ì…˜
- ì´ì¤‘ ì €ì¥ êµ¬ì¡° â†’ ì •ê·œí™”ëœ ì°¸ì¡° êµ¬ì¡°
- ì „ì²´ ë°ì´í„° ë‹¤ìš´ë¡œë“œ â†’ í•„ìš”í•œ ë°ì´í„°ë§Œ ì¡°íšŒ

## ğŸ“ˆ ì„±ëŠ¥ ê°œì„  íš¨ê³¼

### ë¹„ìš© ì ˆì•½
```
ê¸°ì¡´ (Realtime DB):
- ë‹¤ìš´ë¡œë“œ: 934MB/ì¼ Ã— 30ì¼ = 28GB/ì›”
- ë¹„ìš©: 28GB Ã— $1 = $28/ì›” (ì•½ 37,000ì›)

ê°œì„  í›„ (Firestore):
- ì½ê¸°: 19,000 reads (50,000 ë¬´ë£Œ í•œë„ ë‚´)
- ë¹„ìš©: $0/ì›”
```

### ì„±ëŠ¥ í–¥ìƒ
```
ì‘ë‹µ ì‹œê°„:
- ê´€ë¦¬ì í˜ì´ì§€: 3-5ì´ˆ â†’ 200-500ms (90% ê°œì„ )
- ë°ì´í„° í¬ê¸°: 934MB â†’ 10KB (99.9% ê°ì†Œ)
- í˜ì´ì§€ë„¤ì´ì…˜: í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„ (ë¬´í•œ í™•ì¥ ê°€ëŠ¥)
```

## ğŸ—ï¸ ìƒˆë¡œìš´ êµ¬ì¡°

### Firestore ì»¬ë ‰ì…˜ êµ¬ì¡°
```
firestore/
â”œâ”€â”€ users/                    # ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´
â”‚   â””â”€â”€ {userId}/
â”œâ”€â”€ sessions/                 # ì„¸ì…˜ ë©”íƒ€ë°ì´í„°
â”‚   â””â”€â”€ {sessionId}/
â”œâ”€â”€ analyses/                 # ì´ë¯¸ì§€ ë¶„ì„ ê²°ê³¼
â”‚   â””â”€â”€ {analysisId}/
â”œâ”€â”€ recipes/                  # ë ˆì‹œí”¼ ë°ì´í„°
â”‚   â””â”€â”€ {recipeId}/
â”œâ”€â”€ perfumes/                 # í–¥ìˆ˜ ë§ˆìŠ¤í„° ë°ì´í„° (ì •ê·œí™”)
â”‚   â””â”€â”€ {perfumeId}/
â”œâ”€â”€ feedbacks/                # í”¼ë“œë°± ë°ì´í„°
â”‚   â””â”€â”€ {feedbackId}/
â””â”€â”€ confirmations/            # í™•ì • ë°ì´í„°
    â””â”€â”€ {confirmationId}/
```

### ë°ì´í„° ì •ê·œí™”
```javascript
// ê¸°ì¡´ (ì¤‘ë³µ ì €ì¥)
{
  "sessions": {
    "session1": {
      "matchingPerfumes": [/* í° í–¥ìˆ˜ ê°ì²´ë“¤ */]
    }
  }
}

// ê°œì„  í›„ (ì°¸ì¡° ì €ì¥)
{
  "analyses": {
    "analysis1": {
      "matchingPerfumeIds": ["perfume1", "perfume2"]
    }
  },
  "perfumes": {
    "perfume1": {/* í–¥ìˆ˜ ë°ì´í„° */}
  }
}
```

## âš™ï¸ ì„¤ì¹˜ ë° ì„¤ì •

### 1. ì˜ì¡´ì„± ì„¤ì¹˜
```bash
npm install firebase
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
# .env.localì— ì¶”ê°€
USE_FIRESTORE=true
```

### 3. Firestore ì¸ë±ìŠ¤ ì„¤ì •
```bash
# Firebase CLIë¡œ ì¸ë±ìŠ¤ ë°°í¬
firebase deploy --only firestore:indexes
```

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰

### ìë™ ë§ˆì´ê·¸ë ˆì´ì…˜ (ê¶Œì¥)
```bash
# ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
./scripts/deployFirestore.sh
```

### ìˆ˜ë™ ë§ˆì´ê·¸ë ˆì´ì…˜
```bash
# 1. Dry runìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸°
node scripts/migrateToFirestore.js --dry-run

# 2. ë°±ì—… ìƒì„± í›„ ë§ˆì´ê·¸ë ˆì´ì…˜
node scripts/migrateToFirestore.js --backup --batch-size 100

# 3. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
npm run test:performance
```

### ë‹¨ê³„ë³„ ë§ˆì´ê·¸ë ˆì´ì…˜
1. **ë°±ì—… ìƒì„±**: ê¸°ì¡´ ë°ì´í„° ë°±ì—…
2. **ì¸ë±ìŠ¤ ë°°í¬**: Firestore ì¸ë±ìŠ¤ ìµœì í™”
3. **ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜**: ë°°ì¹˜ ë‹¨ìœ„ë¡œ ì•ˆì „í•˜ê²Œ ì´ì „
4. **ê²€ì¦**: ë°ì´í„° ë¬´ê²°ì„± í™•ì¸
5. **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**: ê°œì„  íš¨ê³¼ ì¸¡ì •

## ğŸ”— API ë³€ê²½ì‚¬í•­

### ìƒˆë¡œìš´ Firestore API ì—”ë“œí¬ì¸íŠ¸
```
ê¸°ì¡´                    â†’  ìƒˆë¡œìš´ Firestore ë²„ì „
/api/admin             â†’  /api/admin-firestore
/api/analyze           â†’  /api/analyze-firestore
/api/feedback          â†’  /api/feedback-firestore
/api/recipe            â†’  /api/recipe-firestore
```

### ê´€ë¦¬ì í˜ì´ì§€
```
ê¸°ì¡´: /admin           â†’  ìƒˆë¡œìš´: /admin-firestore
```

### API í˜¸í™˜ì„±
- ê¸°ì¡´ APIëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
- ìƒˆë¡œìš´ Firestore API ë³‘ë ¬ ìš´ì˜
- ì ì§„ì  ì „í™˜ ê°€ëŠ¥

## ğŸ“Š ì„±ëŠ¥ ë¹„êµ

### ê´€ë¦¬ì í˜ì´ì§€ ë¡œë”© ì‹œê°„
| í•­ëª© | Realtime DB | Firestore | ê°œì„ ìœ¨ |
|------|-------------|-----------|--------|
| ì²« í˜ì´ì§€ (10ê°œ) | 3.2ì´ˆ | 0.3ì´ˆ | 90% â†‘ |
| ë‘ ë²ˆì§¸ í˜ì´ì§€ | 3.5ì´ˆ | 0.2ì´ˆ | 94% â†‘ |
| í•„í„°ë§ | 4.1ì´ˆ | 0.4ì´ˆ | 90% â†‘ |
| ìºì‹œ ì ì¤‘ | 5ì´ˆ | 10ms | 99.8% â†‘ |

### ë°ì´í„° ì „ì†¡ëŸ‰
| ê¸°ëŠ¥ | Realtime DB | Firestore | ê°ì†Œìœ¨ |
|------|-------------|-----------|--------|
| í˜ì´ì§€ ë¡œë”© | 934MB | 10KB | 99.9% â†“ |
| ì„¸ì…˜ ì¡°íšŒ | ì „ì²´ ë°ì´í„° | í•„ìš”í•œ ê²ƒë§Œ | 95% â†“ |
| í•„í„°ë§ | í´ë¼ì´ì–¸íŠ¸ ì²˜ë¦¬ | ì„œë²„ ì²˜ë¦¬ | 90% â†“ |

## ğŸ›ï¸ ëª¨ë‹ˆí„°ë§ ë° ê´€ë¦¬

### ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
```javascript
// ìë™ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
const { runPerformanceTest } = require('./utils/performanceMonitor');
const results = await runPerformanceTest('adminDashboard');
```

### ë°ì´í„°ë² ì´ìŠ¤ ì „í™˜
```javascript
// ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì  ì „í™˜
import FirestoreToggle from '@/components/FirestoreToggle';

<FirestoreToggle 
  onToggle={(useFirestore) => {
    // ë°ì´í„°ë² ì´ìŠ¤ ì „í™˜ ë¡œì§
  }}
/>
```

### ìºì‹œ ê´€ë¦¬
```javascript
// Firestore ìºì‹œ ì´ˆê¸°í™”
await fetch('/api/admin-firestore', {
  method: 'PATCH',
  body: JSON.stringify({ action: 'clearCache' })
});
```

## ğŸ”§ ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

#### 1. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨
```bash
# ë°±ì—…ì—ì„œ ë³µì›
node scripts/migrateToFirestore.js --restore backups/latest

# ë¶€ë¶„ ë§ˆì´ê·¸ë ˆì´ì…˜
node scripts/migrateToFirestore.js --batch-size 10
```

#### 2. ì¸ë±ìŠ¤ ì˜¤ë¥˜
```bash
# ì¸ë±ìŠ¤ ìƒíƒœ í™•ì¸
firebase firestore:indexes

# ì¸ë±ìŠ¤ ì¬ë°°í¬
firebase deploy --only firestore:indexes
```

#### 3. ì„±ëŠ¥ ì €í•˜
```javascript
// ì¸ë±ìŠ¤ ëˆ„ë½ í™•ì¸
// Firestore ì½˜ì†”ì—ì„œ ìë™ ì¸ë±ìŠ¤ ì œì•ˆ í™•ì¸
```

#### 4. ë°ì´í„° ë¶ˆì¼ì¹˜
```javascript
// ë°ì´í„° ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
node scripts/validateMigration.js
```

### ë¡¤ë°± í”„ë¡œì„¸ìŠ¤
```bash
# 1. ìë™ ë¡¤ë°±
./scripts/deployFirestore.sh
# â†’ ì„ íƒ: 5) ë¡¤ë°±

# 2. ìˆ˜ë™ ë¡¤ë°±
# .env.localì—ì„œ USE_FIRESTORE=false ì„¤ì •
# ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘
```

## ğŸ“š ì¶”ê°€ ë¦¬ì†ŒìŠ¤

### ë¬¸ì„œ
- [Firestore ê³µì‹ ë¬¸ì„œ](https://firebase.google.com/docs/firestore)
- [Firebase ê°€ê²© ì •ì±…](https://firebase.google.com/pricing)
- [ì¸ë±ìŠ¤ ìµœì í™” ê°€ì´ë“œ](https://firebase.google.com/docs/firestore/query-data/indexing)

### ë„êµ¬
- `utils/performanceMonitor.js` - ì„±ëŠ¥ ë¹„êµ ë„êµ¬
- `scripts/migrateToFirestore.js` - ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸
- `scripts/deployFirestore.sh` - ë°°í¬ ìë™í™”

### ì§€ì›
- ì´ìŠˆ ë°œìƒ ì‹œ: GitHub Issues
- ì„±ëŠ¥ ë¬¸ì œ: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë¦¬í¬íŠ¸ ì²¨ë¶€
- ë§ˆì´ê·¸ë ˆì´ì…˜ ë¬¸ì œ: ë°±ì—… íŒŒì¼ê³¼ ì˜¤ë¥˜ ë¡œê·¸ ì œê³µ

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì „
- [ ] í˜„ì¬ ë°ì´í„° ë°±ì—…
- [ ] Firestore í”„ë¡œì íŠ¸ ì„¤ì • í™•ì¸
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [ ] ì˜ì¡´ì„± ì„¤ì¹˜

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘
- [ ] Dry run ì‹¤í–‰ ë° í™•ì¸
- [ ] ì¸ë±ìŠ¤ ë°°í¬
- [ ] ë°°ì¹˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
- [ ] ë°ì´í„° ê²€ì¦

### ë§ˆì´ê·¸ë ˆì´ì…˜ í›„
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
- [ ] ëª¨ë“  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ëª¨ë‹ˆí„°ë§ ì„¤ì •
- [ ] íŒ€ êµìœ¡ ì™„ë£Œ

---

**ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! Firestore ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.**

ë¹„ìš©ì€ 90% ì ˆì•½í•˜ê³ , ì„±ëŠ¥ì€ 10ë°° í–¥ìƒëœ ìƒˆë¡œìš´ ì‹œìŠ¤í…œì„ ì¦ê¸°ì„¸ìš”! ğŸš€